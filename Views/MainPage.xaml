<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:WeatherDataApp.ViewModels"
             xmlns:models="clr-namespace:WeatherDataApp.Models"
             xmlns:chart="clr-namespace:Syncfusion.Maui.Charts;assembly=Syncfusion.Maui.Charts"
             x:Class="WeatherDataApp.Views.MainPage"
             x:DataType="viewModels:MainPageViewModel">

    <ContentPage.BindingContext>
        <viewModels:MainPageViewModel />
    </ContentPage.BindingContext>

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="10">

            <Label Text="{Binding Status}" FontAttributes="Italic" FontSize="14" />

            <Label Text="{Binding AverageTemperature, StringFormat='Average temperature: {0:F1} °C'}" />
            <Label Text="{Binding MaxTemperature, StringFormat='Max temperature: {0:F1} °C'}" />
            <Label Text="{Binding MinTemperature, StringFormat='Min temperature: {0:F1} °C'}" />
            <Label Text="{Binding AverageWindSpeed, StringFormat='Average wind speed: {0:F1} km/h'}" />
            <Label Text="{Binding AveragePrecipitation, StringFormat='Average precipitation: {0:F2} mm'}" />
            <Label Text="{Binding AverageCloudCover, StringFormat='Average cloud cover: {0:F0}%'}" />
            <Label Text="{Binding AverageHumidity, StringFormat='Average humidity: {0:F0}%'}" />
            <Label Text="{Binding AveragePressure, StringFormat='Average pressure: {0:F0} hPa'}" />

            <HorizontalStackLayout Spacing="10">
                <VerticalStackLayout>
                    <Label Text="Start date:" FontSize="14" />
                    <DatePicker Date="{Binding StartDate}" />
                </VerticalStackLayout>

                <VerticalStackLayout>
                    <Label Text="End date:" FontSize="14" />
                    <DatePicker Date="{Binding EndDate}" />
                </VerticalStackLayout>
            </HorizontalStackLayout>

            <VerticalStackLayout>
                <Label Text="Select which lines to show:" FontAttributes="Bold" />

                <HorizontalStackLayout>
                    <CheckBox IsChecked="{Binding ShowTemperature}" />
                    <Label Text="Temperature" VerticalOptions="Center" />

                    <CheckBox IsChecked="{Binding ShowWind}" />
                    <Label Text="Wind" VerticalOptions="Center" />

                    <CheckBox IsChecked="{Binding ShowPrecipitation}" />
                    <Label Text="Precipitation" VerticalOptions="Center" />
                </HorizontalStackLayout>

                <HorizontalStackLayout>
                    <CheckBox IsChecked="{Binding ShowCloud}" />
                    <Label Text="Cloud Cover" VerticalOptions="Center" />

                    <CheckBox IsChecked="{Binding ShowHumidity}" />
                    <Label Text="Humidity" VerticalOptions="Center" />

                    <CheckBox IsChecked="{Binding ShowPressure}" />
                    <Label Text="Pressure" VerticalOptions="Center" />
                </HorizontalStackLayout>
            </VerticalStackLayout>
            
            <chart:SfCartesianChart HeightRequest="400" IsVisible="{Binding HasChartData}">
                <chart:SfCartesianChart.Legend>
                    <chart:ChartLegend />
                </chart:SfCartesianChart.Legend>

                <chart:SfCartesianChart.XAxes>
                    <chart:DateTimeAxis IntervalType="Days" Interval="1" />
                </chart:SfCartesianChart.XAxes>
                <chart:SfCartesianChart.YAxes>
                    <chart:NumericalAxis />
                </chart:SfCartesianChart.YAxes>

                <chart:LineSeries ItemsSource="{Binding WeatherItems}" XBindingPath="Time" YBindingPath="Temperature"
                                EnableTooltip="True" Label="Temperature" IsVisible="{Binding ShowTemperature}" />

                <chart:LineSeries ItemsSource="{Binding WeatherItems}" XBindingPath="Time" YBindingPath="WindSpeed"
                                EnableTooltip="True" Label="Wind Speed" IsVisible="{Binding ShowWind}" />

                <chart:LineSeries ItemsSource="{Binding WeatherItems}" XBindingPath="Time" YBindingPath="Precipitation"
                                EnableTooltip="True" Label="Precipitation" IsVisible="{Binding ShowPrecipitation}" />

                <chart:LineSeries ItemsSource="{Binding WeatherItems}" XBindingPath="Time" YBindingPath="CloudCover"
                                EnableTooltip="True" Label="Cloud Cover" IsVisible="{Binding ShowCloud}" />

                <chart:LineSeries ItemsSource="{Binding WeatherItems}" XBindingPath="Time" YBindingPath="Humidity"
                                EnableTooltip="True" Label="Humidity" IsVisible="{Binding ShowHumidity}" />

                <chart:LineSeries ItemsSource="{Binding WeatherItems}" XBindingPath="Time" YBindingPath="Pressure"
                                EnableTooltip="True" Label="Pressure" IsVisible="{Binding ShowPressure}" />
            </chart:SfCartesianChart>

            <Button Text="Load weather data" Command="{Binding LoadWeatherCommand}" />

            <CollectionView ItemsSource="{Binding WeatherItems}">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:WeatherData">
                        <Frame BorderColor="Gray" Padding="10" Margin="0,5">
                            <VerticalStackLayout>
                                <Label Text="{Binding Time}" />
                                <Label Text="{Binding Temperature, StringFormat='Temp: {0} °C'}" />
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>