<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:WeatherDataApp.ViewModels"
             xmlns:models="clr-namespace:WeatherDataApp.Models"
             xmlns:chart="clr-namespace:Syncfusion.Maui.Charts;assembly=Syncfusion.Maui.Charts"
             x:Class="WeatherDataApp.Views.MainPage"
             x:DataType="viewModels:MainPageViewModel">

    <ContentPage.BindingContext>
        <viewModels:MainPageViewModel />
    </ContentPage.BindingContext>

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="10">

            <Label Text="{Binding Status}" FontAttributes="Italic" FontSize="14" />

            <Label Text="{Binding AverageTemperature, StringFormat='Average temperature: {0:F1} °C'}" />
            <Label Text="{Binding MaxTemperature, StringFormat='Max temperature: {0:F1} °C'}" />
            <Label Text="{Binding MinTemperature, StringFormat='Min temperature: {0:F1} °C'}" />

            <HorizontalStackLayout Spacing="10">
                <VerticalStackLayout>
                    <Label Text="Start date:" FontSize="14" />
                    <DatePicker Date="{Binding StartDate}" />
                </VerticalStackLayout>

                <VerticalStackLayout>
                    <Label Text="End date:" FontSize="14" />
                    <DatePicker Date="{Binding EndDate}" />
                </VerticalStackLayout>
            </HorizontalStackLayout>

            <chart:SfCartesianChart HeightRequest="300" IsVisible="{Binding HasChartData}">
                <chart:SfCartesianChart.XAxes>
                    <chart:DateTimeAxis IntervalType="Days" Interval="1" />
                </chart:SfCartesianChart.XAxes>
                <chart:SfCartesianChart.YAxes>
                    <chart:NumericalAxis />
                </chart:SfCartesianChart.YAxes>

                <chart:LineSeries
                    ItemsSource="{Binding WeatherItems}"
                    XBindingPath="Time"
                    YBindingPath="Temperature" 
                    EnableTooltip="True" />
            </chart:SfCartesianChart>

            <Button Text="Load weather data" Command="{Binding LoadWeatherCommand}" />

            <CollectionView ItemsSource="{Binding WeatherItems}">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:WeatherData">
                        <Frame BorderColor="Gray" Padding="10" Margin="0,5">
                            <VerticalStackLayout>
                                <Label Text="{Binding Time}" />
                                <Label Text="{Binding Temperature, StringFormat='Temp: {0} °C'}" />
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>